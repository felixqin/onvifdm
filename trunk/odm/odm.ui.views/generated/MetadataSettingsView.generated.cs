
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Reactive.Disposables;
using System.Windows.Input;
using odm.infra;
namespace odm.ui.activities {
	using global::onvif.services;
	using global::System.Xml.Schema;
	
	public partial class MetadataSettingsView{
		
		#region Model definition
		
		public interface IModelAccessor{
			bool includeAnalitycs{get;set;}
			bool includePtzStatus{get;set;}
			bool includePtzPosition{get;set;}
			bool includeEvents{get;set;}
			TopicExpressionFilter[] topicExpressionFilters{get;set;}
			MessageContentFilter[] messageContentFilters{get;set;}
			
		}
		public class Model: IModelAccessor, INotifyPropertyChanged{
			
			public Model(
				bool isPtzStatusSupported, bool isPtzPositionSupported, string[] messageContentFilterDialects, string[] topicExpressionDialects, bool isFixedTopicSet, TopicSetType topicSet
			){
				
				this.isPtzStatusSupported = isPtzStatusSupported;
				this.isPtzPositionSupported = isPtzPositionSupported;
				this.messageContentFilterDialects = messageContentFilterDialects;
				this.topicExpressionDialects = topicExpressionDialects;
				this.isFixedTopicSet = isFixedTopicSet;
				this.topicSet = topicSet;
			}
			private Model(){
			}
			

			public static Model Create(
				bool includeAnalitycs,
				bool isPtzStatusSupported,
				bool includePtzStatus,
				bool isPtzPositionSupported,
				bool includePtzPosition,
				bool includeEvents,
				string[] messageContentFilterDialects,
				string[] topicExpressionDialects,
				bool isFixedTopicSet,
				TopicSetType topicSet,
				TopicExpressionFilter[] topicExpressionFilters,
				MessageContentFilter[] messageContentFilters
			){
				var _this = new Model();
				
				_this.isPtzStatusSupported = isPtzStatusSupported;
				_this.isPtzPositionSupported = isPtzPositionSupported;
				_this.messageContentFilterDialects = messageContentFilterDialects;
				_this.topicExpressionDialects = topicExpressionDialects;
				_this.isFixedTopicSet = isFixedTopicSet;
				_this.topicSet = topicSet;
				_this.origin.includeAnalitycs = includeAnalitycs;
				_this.origin.includePtzStatus = includePtzStatus;
				_this.origin.includePtzPosition = includePtzPosition;
				_this.origin.includeEvents = includeEvents;
				_this.origin.topicExpressionFilters = topicExpressionFilters;
				_this.origin.messageContentFilters = messageContentFilters;
				_this.RevertChanges();
				
				return _this;
			}
		
				private SimpleChangeTrackable<bool> m_includeAnalitycs;
				private SimpleChangeTrackable<bool> m_includePtzStatus;
				private SimpleChangeTrackable<bool> m_includePtzPosition;
				private SimpleChangeTrackable<bool> m_includeEvents;
				private SimpleChangeTrackable<TopicExpressionFilter[]> m_topicExpressionFilters;
				private SimpleChangeTrackable<MessageContentFilter[]> m_messageContentFilters;
				public bool isPtzStatusSupported{get;private set;}
				public bool isPtzPositionSupported{get;private set;}
				public string[] messageContentFilterDialects{get;private set;}
				public string[] topicExpressionDialects{get;private set;}
				public bool isFixedTopicSet{get;private set;}
				public TopicSetType topicSet{get;private set;}

			private class OriginAccessor: IModelAccessor {
				private Model m_model;
				public OriginAccessor(Model model) {
					m_model = model;
				}
				bool IModelAccessor.includeAnalitycs {
					get {return m_model.m_includeAnalitycs.origin;}
					set {m_model.m_includeAnalitycs.origin = value;}
				}
				bool IModelAccessor.includePtzStatus {
					get {return m_model.m_includePtzStatus.origin;}
					set {m_model.m_includePtzStatus.origin = value;}
				}
				bool IModelAccessor.includePtzPosition {
					get {return m_model.m_includePtzPosition.origin;}
					set {m_model.m_includePtzPosition.origin = value;}
				}
				bool IModelAccessor.includeEvents {
					get {return m_model.m_includeEvents.origin;}
					set {m_model.m_includeEvents.origin = value;}
				}
				TopicExpressionFilter[] IModelAccessor.topicExpressionFilters {
					get {return m_model.m_topicExpressionFilters.origin;}
					set {m_model.m_topicExpressionFilters.origin = value;}
				}
				MessageContentFilter[] IModelAccessor.messageContentFilters {
					get {return m_model.m_messageContentFilters.origin;}
					set {m_model.m_messageContentFilters.origin = value;}
				}
				
			}
			public event PropertyChangedEventHandler PropertyChanged;
			private void NotifyPropertyChanged(string propertyName){
				var prop_changed = this.PropertyChanged;
				if (prop_changed != null) {
					prop_changed(this, new PropertyChangedEventArgs(propertyName));
				}
			}
			
			public bool includeAnalitycs  {
				get {return m_includeAnalitycs.current;}
				set {
					if(m_includeAnalitycs.current != value) {
						m_includeAnalitycs.current = value;
						NotifyPropertyChanged("includeAnalitycs");
					}
				}
			}
			
			public bool includePtzStatus  {
				get {return m_includePtzStatus.current;}
				set {
					if(m_includePtzStatus.current != value) {
						m_includePtzStatus.current = value;
						NotifyPropertyChanged("includePtzStatus");
					}
				}
			}
			
			public bool includePtzPosition  {
				get {return m_includePtzPosition.current;}
				set {
					if(m_includePtzPosition.current != value) {
						m_includePtzPosition.current = value;
						NotifyPropertyChanged("includePtzPosition");
					}
				}
			}
			
			public bool includeEvents  {
				get {return m_includeEvents.current;}
				set {
					if(m_includeEvents.current != value) {
						m_includeEvents.current = value;
						NotifyPropertyChanged("includeEvents");
					}
				}
			}
			
			public TopicExpressionFilter[] topicExpressionFilters  {
				get {return m_topicExpressionFilters.current;}
				set {
					if(m_topicExpressionFilters.current != value) {
						m_topicExpressionFilters.current = value;
						NotifyPropertyChanged("topicExpressionFilters");
					}
				}
			}
			
			public MessageContentFilter[] messageContentFilters  {
				get {return m_messageContentFilters.current;}
				set {
					if(m_messageContentFilters.current != value) {
						m_messageContentFilters.current = value;
						NotifyPropertyChanged("messageContentFilters");
					}
				}
			}
			
			public void AcceptChanges() {
				m_includeAnalitycs.AcceptChanges();
				m_includePtzStatus.AcceptChanges();
				m_includePtzPosition.AcceptChanges();
				m_includeEvents.AcceptChanges();
				m_topicExpressionFilters.AcceptChanges();
				m_messageContentFilters.AcceptChanges();
				
			}

			public void RevertChanges() {
				this.current.includeAnalitycs= this.origin.includeAnalitycs;
				this.current.includePtzStatus= this.origin.includePtzStatus;
				this.current.includePtzPosition= this.origin.includePtzPosition;
				this.current.includeEvents= this.origin.includeEvents;
				this.current.topicExpressionFilters= this.origin.topicExpressionFilters;
				this.current.messageContentFilters= this.origin.messageContentFilters;
				
			}

			public bool isModified {
				get {
					if(m_includeAnalitycs.isModified)return true;
					if(m_includePtzStatus.isModified)return true;
					if(m_includePtzPosition.isModified)return true;
					if(m_includeEvents.isModified)return true;
					if(m_topicExpressionFilters.isModified)return true;
					if(m_messageContentFilters.isModified)return true;
					
					return false;
				}
			}

			public IModelAccessor current {
				get {return this;}
				
			}

			public IModelAccessor origin {
				get {return new OriginAccessor(this);}
				
			}
		}
			
		#endregion
	
		#region Result definition
		public abstract class Result{
			private Result() { }
			
			public abstract T Handle<T>(
				
				Func<Model,T> apply,
				Func<T> none
			);
	
			public bool IsApply(){
				return AsApply() != null;
			}
			public virtual Apply AsApply(){ return null; }
			public class Apply : Result {
				public Apply(Model model){
					
					this.model = model;
					
				}
				public Model model{ get; set; }
				public override Apply AsApply(){ return this; }
				
				public override T Handle<T>(
				
					Func<Model,T> apply,
					Func<T> none
				){
					return apply(
						model
					);
				}
	
			}
			
			public bool IsNone(){
				return AsNone() != null;
			}
			public virtual None AsNone(){ return null; }
			public class None : Result {
				public None(){
					
				}
				
				public override None AsNone(){ return this; }
				
				public override T Handle<T>(
				
					Func<Model,T> apply,
					Func<T> none
				){
					return none(
						
					);
				}
	
			}
			
		}
		#endregion

		public ICommand ApplyCommand{ get; private set; }
		public ICommand NoneCommand{ get; private set; }
		
		IActivityContext<Result> activityContext = null;
		SingleAssignmentDisposable activityCancellationSubscription = new SingleAssignmentDisposable();
		bool activityCompleted = false;
		//activity has been completed
		event Action OnCompleted = null;
		//activity has been failed
		event Action<Exception> OnError = null;
		//activity has been completed successfully
		event Action<Result> OnSuccess = null;
		//activity has been canceled
		event Action OnCancelled = null;
		
		public MetadataSettingsView(Model model, IActivityContext<Result> activityContext) {
			this.activityContext = activityContext;
			if(activityContext!=null){
				activityCancellationSubscription.Disposable = 
					activityContext.RegisterCancellationCallback(() => {
						EnsureAccess(() => {
							CompleteWith(() => {
								if(OnCancelled!=null){
									OnCancelled();
								}
							});
						});
					});
			}
			Init(model);
		}

		
		public void EnsureAccess(Action action){
			if(!CheckAccess()){
				Dispatcher.Invoke(action);
			}else{
				action();
			}
		}

		public void CompleteWith(Action cont){
			if(!activityCompleted){
				activityCompleted = true;
				cont();
				if(OnCompleted!=null){
					OnCompleted();
				}
				activityCancellationSubscription.Dispose();
			}
		}
		public void Success(Result result) {
			CompleteWith(() => {
				if(activityContext!=null){
					activityContext.Success(result);
				}
				if(OnSuccess!=null){
					OnSuccess(result);
				}
			});
		}
		public void Error(Exception error) {
			CompleteWith(() => {
				if(activityContext!=null){
					activityContext.Error(error);
				}
				if(OnError!=null){
					OnError(error);
				}
			});
		}
		public void Cancel() {
			CompleteWith(() => {
				if(activityContext!=null){
					activityContext.Cancel();
				}
				if(OnCancelled!=null){
					OnCancelled();
				}
			});
		}
		public void Success(Func<Result> resultFactory) {
			CompleteWith(() => {
				var result = resultFactory();
				if(activityContext!=null){
					activityContext.Success(result);
				}
				if(OnSuccess!=null){
					OnSuccess(result);
				}
			});
		}
		public void Error(Func<Exception> errorFactory) {
			CompleteWith(() => {
				var error = errorFactory();
				if(activityContext!=null){
					activityContext.Error(error);
				}
				if(OnError!=null){
					OnError(error);
				}
			});
		}
		public void Cancel(Action action) {
			CompleteWith(() => {
				action();
				if(activityContext!=null){
					activityContext.Cancel();
				}
				if(OnCancelled!=null){
					OnCancelled();
				}
			});
		}
		
	}
}
